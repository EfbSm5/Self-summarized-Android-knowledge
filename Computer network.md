# 输入 URL 后发生什么
- URL 组成与默认资源
  - 示例：bilibili.com
  - 若路径未指定后缀，通常访问默认资源（如 index.html）
- 目标：定位对应的 Web 服务器
# 生成并发送 HTTP 请求
- 构造 HTTP 请求报文（方法、路径、头、体）
- 待网络层可达后发送

#  名称解析与寻址
- 仅有域名未知 IP：通过 DNS 将域名解析为 IP 地址
- 发送前需完成二层寻址：通过 ARP 获取目标 MAC（同网段）或网关 MAC（跨网段）

# 协议栈与硬件发送
- 操作系统网络协议栈分层封装并交由网卡发送

#  TCP 连接建立（三次握手）
- 客户端：SYN
- 服务器：SYN + ACK
- 客户端：ACK，连接建立，开始传输数据
- 说明：服务器握手完成后从 LISTEN 转入 ESTABLISHED

# 为什么要三次握手？
1. 确认双方收发能力正常
2. 防止历史连接（旧 SYN）导致的“伪连接”，如果只两次握手，可能客户端旧包就让客户端打开链接  
3. 正确同步初始序列号（ISN）与相关参数

# TCP连接的四次挥手   
- Client：FIN（数据发送完成）
- Server：ACK（等待服务器数据发送完成）
- Server：FIN（数据发送完成）
-Client：ACK（确认断开）

# TIME_WAIT 和 CLOSE_WAIT 
- TIME_WAIT（主动关闭方）  
主动发起关闭的一方在发送最后一个 ACK 后进入的状态，等两倍 MSL，既为对端补发 ACK，也为旧包自然消失，防止端口混淆。
- CLOSE_WAIT（被动关闭方）  
一方在接收到对端的 FIN 并回 ACK 后、在自己还未调用 close 发送 FIN 之前所处的状态，如果卡在这里可能是应用没及时关。

# TCP 滑动窗口  
- 核心作用
在不等待逐包确认的情况下，允许发送方“成批”连续发送多段数据，提高吞吐。用“窗口”表示可未被确认而连续发送的字节范围，窗口随 ACK 推进而“滑动”。

# 流量控制（Flow Control）
流量控制是端到端“接收端保护”，不关心网络是否拥塞，仅看接收方缓冲承载能力。以接收方能力为准，动态限制发送速率。  
实现机制：接收窗口 rwnd  
接收方在 ACK 中通告自身可用缓冲大小 rwnd。发送方的可发送量受限于 rwnd：必须满足 in-flight ≤ rwnd。当 rwnd 降为 0，发送方停止发送，仅周期性发送零窗口探测包（ZWP）询问接收方是否恢复。

# 拥塞控制
防止“网络”被过量流量淹没，降低丢包/时延膨胀。与流量控制不同，它保护“网络中间路径”。  
实现机制：拥塞窗口 cwnd
发送方维护 cwnd，限制自身在网络中的未确认数据量：有效发送窗口 = min(rwnd, cwnd)。只有当两者都允许时，才能继续发送。rwnd 受接收端约束，cwnd 受网络拥塞状态约束。 包含慢启动、拥塞避免、快速重传/恢复等策略。


# HTTPS 额外的 TLS 握手（四步示意）
1) ClientHello：随机数、支持的协议与密码套件等
2) ServerHello：选择密码套件、返回随机数与服务器证书
3) 客户端验证证书，用服务器公钥加密新的随机数发给服务器；双方据此派生会话密钥；客户端以加密方式发送握手验证数据
4) 服务器也发送加密的握手验证数据；验证通过后加密通信开始

注：实际 TLS1.2/1.3 消息更细，TLS1.3 将往返数减少。

---

# Socket 与 WebSocket

- Socket：操作系统提供的网络通信编程接口与通信端点抽象，本质是对 TCP/UDP 的封装，不是协议。
- WebSocket：基于 TCP 的应用层协议，经由 HTTP(S) 握手升级为全双工、持久连接，常用于实时通信。

---

# OSI网络分层概览

- 应用层：提供应用接口（HTTP、DNS、WebSocket 等）
- 表示层：数据表示/编码转换
- 会话层：会话建立、管理、终止
- 传输层：端到端传输（TCP/UDP）
- 网络层：路由与转发（IP）
- 数据链路层：成帧、MAC 寻址（以太网）
- 物理层：比特在物理介质上传输

注：实际实现常以 TCP/IP 五层模型描述，应用层，传输层，网络层，数据链路层，物理层。

---

# UDP 视频聊天的丢包应对策略

- 自适应码率（ABR）：根据网络状况动态调整分辨率、码率、帧率，减少拥塞与丢包
- FEC 前向纠错：发送冗余包，接收端在不显著增加延迟下恢复少量丢包
- 受限重传：仅对关键数据有限度重传，设置严格超时，控制时延
- 错误隐藏（错误掩盖）：接收端使用插值/邻域像素/上一帧内容进行掩盖，弱化观感影响
- 目标：在延迟与画质间权衡，保证实时性与连贯性

---

# HTTP 版本演进

- HTTP/1.0：短连接
- HTTP/1.1：默认长连接，引入管道化但仍有队头阻塞
- HTTP/2：头部压缩、二进制分帧、多路复用，缓解 HTTP 层队头阻塞
- HTTP/3：基于 QUIC（UDP），进一步消除队头阻塞并改进握手与迁移

---

# HTTP 状态码分类

- 1xx 信息：请求已接收，继续处理
- 2xx 成功：请求成功处理
- 3xx 重定向：需要进一步操作
- 4xx 客户端错误：请求有误或无法完成
- 5xx 服务器错误：服务器处理请求时出错

---

# HTTP 请求报文结构

- 请求行：METHOD SP URL SP HTTP/Version
  - 例：GET /path HTTP/1.1
- 请求头部：若干键值对
  - 例：Host: apigo.cn
- 请求体：可选（如 POST/PUT 携带数据）

---  
# Http 长连接  
-   TCP 层（传输层）
  客户端与服务端通过 TCP 三次握手建立一条连接，只要双方不关闭且未超时，这条连接就可以继续存在。操作系统可启用 TCP Keepalive 帮助在空闲时探测对端是否仍在，从而更长时间保持连接。
- HTTP 协议层（应用层）
HTTP/1.1：默认使用持久连接（persistent connection，俗称 keep-alive）。如果没有发送 Connection: close，客户端可以在同一条 TCP 连接上连续发多个请求（通常串行复用）。
- 客户端实现层（连接池）
维护“连接池”，在同一主机/端口下尽量复用已有连接，并根据空闲时间、健康检查等策略决定何时回收或重建连接。
- 保活手段

# 数字证书的签发与验证过程  
- 签发  
1. 申请者本地生成公钥私钥  
2. 生成请求（CSR）
3. 提交CSR  
 
 # TCP和UDP区别  
 TCP 需要三次握手，发送数据会确认数据到达，发送过后需要接收方返回确认，数据包带上顺序，存在流量控制  
 UDP更快

 # 常用的断线重连时长
 通用：
  - 首次重试延迟：100–500 ms
  - 指数退避倍数：×2 或 ×1.5
  - 抖动（随机扰动）：±20% 或使用全抖动（random(0, base)）
  - 最大重试延迟：15–60 s
  - 最大重试次数：3–7 次（幂等请求可更多；非幂等要谨慎）
  - 总超时时间（cap）：30–120 s 或按业务 SLA 设定

WebSocket，长连接：  
  - 首次重连：1–2 s
  - 退避策略：指数退避（×2），带抖动
  - 最大重连间隔：20–60 s
  - 心跳间隔（保活）：20–30 s（需小于任何一跳的 idle timeout 的一半）
  - 判定断线超时：读空闲 30–60 s（服务器可能更长/更短）
  - 总重连时长：不限时（前台）/受限（后台或移动端省电策略）

# 如何鉴权用户
1. 账号密码  
2. 第三方登陆  
3. 验证码  
4. 客户端凭证

# DNS劫持  
篡改域名解析过程，使“域名 → IP”的映射被错误引导，用户被导向攻击者指定的服务器或页面。  

# 中间人攻击  
攻击者插入在通信双方之间，拦截、篡改或伪造通信内容，同时尽量不被双方察觉。